{"remainingRequest":"/Users/ingjuliovasquez/Documents/Proyectos/encuestas_personales/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ingjuliovasquez/Documents/Proyectos/encuestas_personales/src/views/user/Survey.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ingjuliovasquez/Documents/Proyectos/encuestas_personales/src/views/user/Survey.vue","mtime":1655265492699},{"path":"/Users/ingjuliovasquez/Documents/Proyectos/encuestas_personales/node_modules/cache-loader/dist/cjs.js","mtime":1655263279431},{"path":"/Users/ingjuliovasquez/Documents/Proyectos/encuestas_personales/node_modules/babel-loader/lib/index.js","mtime":1655263279743},{"path":"/Users/ingjuliovasquez/Documents/Proyectos/encuestas_personales/node_modules/cache-loader/dist/cjs.js","mtime":1655263279431},{"path":"/Users/ingjuliovasquez/Documents/Proyectos/encuestas_personales/node_modules/vue-loader/lib/index.js","mtime":1655263279849}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGNvbGxlY3Rpb24sIGdldERvYywgYWRkRG9jLCB1cGRhdGVEb2MsIGRvYyB9IGZyb20gImZpcmViYXNlL2ZpcmVzdG9yZSI7CgpleHBvcnQgZGVmYXVsdCB7CiAgcHJvcHM6IFsic3VydmV5SWQiXSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc3VydmV5OiB7CiAgICAgICAgbmFtZTogIiIsCiAgICAgICAgZW1haWw6ICIiLAogICAgICAgIGN1cnA6ICIiLAogICAgICAgIGZlZGVyYWxFbnRpdHk6ICIiLAogICAgICAgIHBob25lOiAiIiwKICAgICAgfSwKICAgIH07CiAgfSwKICBtb3VudGVkKCkgewogICAgaWYgKHRoaXMuc3VydmV5SWQpIHRoaXMuZWRpdFN1cnZleSgpOwogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgYWRkU3VydmV5KCkgewogICAgICBjb25zdCB2YWxpZGF0ZSA9IGF3YWl0IHRoaXMudmFsaWRhdGVGaWVsZHMoKTsKCiAgICAgIGlmICh2YWxpZGF0ZSkgewogICAgICAgIGNvbnN0IHJlc2V0Rm9ybSA9IHsKICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgZW1haWw6ICIiLAogICAgICAgICAgY3VycDogIiIsCiAgICAgICAgICBmZWRlcmFsRW50aXR5OiAiIiwKICAgICAgICAgIHBob25lOiAiIiwKICAgICAgICB9OwoKICAgICAgICB0cnkgewogICAgICAgICAgYXdhaXQgYWRkRG9jKGNvbGxlY3Rpb24od2luZG93LmRiLCAic3VydmV5cyIpLCB0aGlzLnN1cnZleSk7CiAgICAgICAgICBhd2FpdCB0aGlzLnN1Ym1pdEVtYWlsKCk7CgogICAgICAgICAgdGhpcy5zdXJ2ZXkgPSByZXNldEZvcm07CgogICAgICAgICAgdGhpcy4kcmVmcy5lbmN1ZXN0YS5yZXNldCgpOwoKICAgICAgICAgIHdpbmRvdy5Td2FsLmZpcmUod2luZG93LlN3YWxTdG9yZSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgYWRkaW5nIGRvY3VtZW50OiAiLCBlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBlZGl0U3VydmV5KCkgewogICAgICBjb25zdCBzdXJ2ZXkgPSBhd2FpdCBnZXREb2MoZG9jKHdpbmRvdy5kYiwgInN1cnZleXMiLCB0aGlzLnN1cnZleUlkKSk7CiAgICAgIHRoaXMuc3VydmV5ID0gc3VydmV5LmRhdGEoKTsKICAgIH0sCiAgICBhc3luYyB1cGRhdGVTdXJ2ZXkoKSB7CiAgICAgIGNvbnN0IHZhbGlkYXRlID0gYXdhaXQgdGhpcy52YWxpZGF0ZUZpZWxkcygpOwoKICAgICAgaWYgKHZhbGlkYXRlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYygKICAgICAgICAgICAgZG9jKHdpbmRvdy5kYiwgInN1cnZleXMiLCB0aGlzLnN1cnZleUlkKSwKICAgICAgICAgICAgdGhpcy5zdXJ2ZXkKICAgICAgICAgICk7CgogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goIi9zdXJ2ZXlzIik7CgogICAgICAgICAgd2luZG93LlN3YWwuZmlyZSh3aW5kb3cuU3dhbFVwZGF0ZSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgdXBkYXRpbmcgZG9jdW1lbnQ6ICIsIGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFzeW5jIHZhbGlkYXRlRmllbGRzKCkgewogICAgICByZXR1cm4gYXdhaXQgdGhpcy4kcmVmcy5lbmN1ZXN0YS52YWxpZGF0ZSgpLnRoZW4oKHN1Y2Nlc3MpID0+IHsKICAgICAgICByZXR1cm4gc3VjY2VzczsKICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgc3VibWl0RW1haWwoKSB7CiAgICAgIC8vIE1ha2UgRm9ybSBEYXRhCiAgICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoKICAgICAgLy8gU2V0IEZvcm0gRGF0YSBWYWx1ZXMKICAgICAgZm9ybURhdGEuYXBwZW5kKCJuYW1lIiwgdGhpcy5zdXJ2ZXkubmFtZSk7CiAgICAgIGZvcm1EYXRhLmFwcGVuZCgiZW1haWwiLCB0aGlzLnN1cnZleS5lbWFpbCk7CgogICAgICByZXR1cm4gYXdhaXQgZmV0Y2goInBocC9mb3JtLnBocCIsIHsgbWV0aG9kOiAiUE9TVCIsIGJvZHk6IGZvcm1EYXRhIH0pOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["Survey.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Survey.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\n  <div class=\"survey\">\n    <ValidationObserver ref=\"encuesta\">\n      <form\n        class=\"questions\"\n        @submit.prevent=\"surveyId ? updateSurvey() : addSurvey()\"\n      >\n        <h1>Encuestas Personales</h1>\n        <ValidationProvider\n          name=\"Nombre\"\n          rules=\"required|alpha_spaces\"\n          v-slot=\"{ errors }\"\n        >\n          <div class=\"field\">\n            <label for=\"\" class=\"required\"> Escribe tu nombre completo </label>\n            <input type=\"text\" v-model=\"survey.name\" />\n            <small class=\"text-danger\" v-if=\"errors.length\">\n              {{ errors[0] }}\n            </small>\n          </div>\n        </ValidationProvider>\n\n        <ValidationProvider\n          name=\"Email\"\n          rules=\"required|email\"\n          v-slot=\"{ errors }\"\n        >\n          <div class=\"field\">\n            <label for=\"\" class=\"required\"> Escribe tu correo </label>\n            <input type=\"email\" v-model=\"survey.email\" />\n            <small class=\"text-danger\" v-if=\"errors.length\">\n              {{ errors[0] }}\n            </small>\n          </div>\n        </ValidationProvider>\n\n        <ValidationProvider\n          name=\"Curp\"\n          rules=\"required|alpha\"\n          v-slot=\"{ errors }\"\n        >\n          <div class=\"field\">\n            <label for=\"\" class=\"required\">Escribe tu CURP</label>\n            <input type=\"text\" v-model=\"survey.curp\" />\n            <small class=\"text-danger\" v-if=\"errors.length\">\n              {{ errors[0] }}\n            </small>\n          </div>\n        </ValidationProvider>\n\n        <ValidationProvider\n          name=\"Entidad federativa\"\n          rules=\"required\"\n          v-slot=\"{ errors }\"\n        >\n          <div class=\"field\">\n            <label for=\"\" class=\"required\"\n              >Entidad federativa de Residencia</label\n            >\n            <select v-model=\"survey.federalEntity\">\n              <option value=\"Veracruz\" selected>\n                Veracruz\n              </option>\n                <option value=\"Nuevo León\" selected>\n                Nuevo León\n              </option>\n                <option value=\"Puebla\" selected>\n                Puebla\n              </option>\n            </select>\n            <small class=\"text-danger\" v-if=\"errors.length\">\n              {{ errors[0] }}\n            </small>\n          </div>\n        </ValidationProvider>\n\n        <ValidationProvider\n          name=\"Numero de contacto\"\n          rules=\"required|numeric|min:10|max:10\"\n          v-slot=\"{ errors }\"\n        >\n          <div class=\"field\">\n            <label for=\"\" class=\"required\">Numero de contacto</label>\n            <input type=\"text\" v-model=\"survey.phone\" />\n            <small class=\"text-danger\" v-if=\"errors.length\">\n              {{ errors[0] }}\n            </small>\n          </div>\n        </ValidationProvider>\n\n        <div v-if=\"!surveyId\">\n          <button class=\"btn-pm\">Registrar encuesta</button>\n        </div>\n        <div v-else>\n          <button class=\"btn-pm btn-udt\">Actualizar encuesta</button>\n          <router-link to=\"/surveys\" class=\"btn-dg btn-link\">\n            Cancelar\n          </router-link>\n        </div>\n      </form>\n    </ValidationObserver>\n  </div>\n</template>\n\n<script>\nimport { collection, getDoc, addDoc, updateDoc, doc } from \"firebase/firestore\";\n\nexport default {\n  props: [\"surveyId\"],\n  data() {\n    return {\n      survey: {\n        name: \"\",\n        email: \"\",\n        curp: \"\",\n        federalEntity: \"\",\n        phone: \"\",\n      },\n    };\n  },\n  mounted() {\n    if (this.surveyId) this.editSurvey();\n  },\n  methods: {\n    async addSurvey() {\n      const validate = await this.validateFields();\n\n      if (validate) {\n        const resetForm = {\n          name: \"\",\n          email: \"\",\n          curp: \"\",\n          federalEntity: \"\",\n          phone: \"\",\n        };\n\n        try {\n          await addDoc(collection(window.db, \"surveys\"), this.survey);\n          await this.submitEmail();\n\n          this.survey = resetForm;\n\n          this.$refs.encuesta.reset();\n\n          window.Swal.fire(window.SwalStore);\n        } catch (e) {\n          console.error(\"Error adding document: \", e);\n        }\n      }\n    },\n    async editSurvey() {\n      const survey = await getDoc(doc(window.db, \"surveys\", this.surveyId));\n      this.survey = survey.data();\n    },\n    async updateSurvey() {\n      const validate = await this.validateFields();\n\n      if (validate) {\n        try {\n          await updateDoc(\n            doc(window.db, \"surveys\", this.surveyId),\n            this.survey\n          );\n\n          this.$router.push(\"/surveys\");\n\n          window.Swal.fire(window.SwalUpdate);\n        } catch (e) {\n          console.error(\"Error updating document: \", e);\n        }\n      }\n    },\n    async validateFields() {\n      return await this.$refs.encuesta.validate().then((success) => {\n        return success;\n      });\n    },\n    async submitEmail() {\n      // Make Form Data\n      let formData = new FormData();\n\n      // Set Form Data Values\n      formData.append(\"name\", this.survey.name);\n      formData.append(\"email\", this.survey.email);\n\n      return await fetch(\"php/form.php\", { method: \"POST\", body: formData });\n    },\n  },\n};\n</script>\n\n"]}]}